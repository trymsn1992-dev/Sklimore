# Skimore Challenge - Walkthrough (Supabase Edition)

## Prerequisities
1.  **Supabase Project**:
    -   Go to [Supabase](https://supabase.com/).
    -   Create a new project.
    -   Get `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_ANON_KEY`.
    -   Update `.env.local`.

## Database Setup (SQL)
Run this SQL in your Supabase SQL Editor:
```sql
-- Create profiles table
create table public.profiles (
  id uuid references auth.users not null,
  full_name text,
  avatar_url text,
  days int default 0,
  trips int default 0,
  meters int default 0,
  updated_at timestamp with time zone,
  primary key (id)
);

-- Separate friendships table
create table public.friendships (
  id bigint generated by default as identity primary key,
  user_id uuid references public.profiles(id) not null,
  friend_id uuid references public.profiles(id) not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  unique(user_id, friend_id)
);

-- RLS Policies (Simplest for now)
alter table public.profiles enable row level security;
alter table public.friendships enable row level security;

create policy "Public profiles are viewable by everyone."
  on profiles for select
  using ( true );

create policy "Users can insert their own profile."
  on profiles for insert
  with check ( auth.uid() = id );

create policy "Users can update own profile."
  on profiles for update
  using ( auth.uid() = id );

create policy "Friendships viewable by everyone"
  on friendships for select
  using ( true );

create policy "Users can manage their own friendships"
  on friendships for all
  using ( auth.uid() = user_id );
```

## Deployment (Vercel)
1.  Push code to GitHub.
2.  Import project in Vercel: [https://vercel.com/new](https://vercel.com/new)
3.  Add Environment Variables (`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`).
4.  Deploy!

## Features Implemented
### 1. Authentication
-   **Supabase Auth** (Google Provider).
    -   [Guide: Setup Google Auth](https://supabase.com/docs/guides/auth/social-login/auth-google)
    -   [Google Cloud Console](https://console.cloud.google.com/) (for Client ID/Secret)
-   User profile creation trigger on login.

### 2. Stats Upload
-   OCR via Tesseract.js.
-   Updates `profiles` table in Supabase.

### 3. Social
-   Friends list managed via `friendships` join table.
-   Leaderboard with "Friends Only" filter.
